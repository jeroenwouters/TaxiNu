//Backbone Options
function enable_drag(e){e.draggable({helper:"clone",revert:"invalid",cursor:"move",start:function(e,t){$(t.helper).addClass("ui-draggable-helper");$(this).hide()},stop:function(e,t){$(this).show()}})}function taximap(){var e={zoom:13,center:new google.maps.LatLng(51.283333,4.483333),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),e)}function afstandfunc(e,t){$.ajax({type:"GET",url:"http://maps.googleapis.com/maps/api/distancematrix/json?origins="+e+"&destinations="+t+"&sensor=false",dataType:"json",success:function(e){return e.rows[0].elements[0].distance.text}})}Backbone.emulateHTTP=!0;var current_user_id,current_user_login,channel_bedrijf,map,map_model,geocoder=new google.maps.Geocoder,markerBounds=new google.maps.LatLngBounds,directionsDisplay,Bestelling=Backbone.Model.extend({setstatus:function(e){this.set({status:e,wachttijd:$(".wachttijd").val()});this.save()},showmodal:function(){var e=new BestellingRevealView({model:this});$("#checkmodal").reveal();if(this.get("status")==2)var t=3;else var t=2;this.get("status")==5&&(t=5);$("#checkmodal .inforit").html(e.render(t).el)}}),BestellingList=Backbone.Collection.extend({model:Bestelling,url:"api/bestelling/"}),Taxi=Backbone.Model.extend({}),TaxiList=Backbone.Collection.extend({model:Taxi,url:"api/taxi/"}),User=Backbone.Model.extend({url:"admin/getuser",parse:function(e,t){current_user_id=e.id;current_user_login=e.username;AdminPanel.taxiList.fetch({data:{userid:e.id}});channel_bedrijf=pusher.subscribe("private-bedrijf_"+current_user_id)}}),BestellingView=Backbone.View.extend({template:Handlebars.compile(bestelling_tempalte),events:{"click button":"showmodule"},render:function(){if(this.model.get("status")!=1||this.model.get("afgerond")!=1){this.$el.html(this.template(this.model.toJSON()));this.model.get("status")==1&&enable_drag(this.$el);if(this.model.get("status")==3){this.$el.css("background-color","#90BD3C");enable_drag(this.$el)}if(this.model.get("status")==2){this.$el.css("background-color","#FD4000");enable_drag(this.$el)}if(this.model.get("status")==4){this.$el.find(".mark").hide();this.$el.css("background-color","#F2A81D")}if(this.model.get("status")==5){this.$el.find(".mark").hide();this.$el.css("opacity","0.5")}return this}},showmodule:function(){this.model.showmodal()}}),BestellingRevealView=Backbone.View.extend({template1:Handlebars.compile(module_bestelling_template1),template2:Handlebars.compile(module_bestelling_template2),template3:Handlebars.compile(module_bestelling_template3),template5:Handlebars.compile(module_bestelling_template5),events:{"click .go":"go","click .cancel":"cancel","click .verwijder":"verwijder"},render:function(e){e==1&&this.$el.html(this.template1(this.model.toJSON()));e==2&&this.$el.html(this.template2(this.model.toJSON()));e==3&&this.$el.html(this.template3(this.model.toJSON()));e==5&&this.$el.html(this.template5(this.model.toJSON()));return this},go:function(){this.model.setstatus(2);$("#"+this.model.get("id")).css("background-color","#FD4000");$("#checkmodal").trigger("reveal:close");console.log(this.model)},cancel:function(){$.post(base_url+"admin/cancelorderadmin/"+this.model.get("id")+"/"+current_user_id);$("#col1 ul").append($("#"+this.model.get("id")));$("#"+this.model.get("id")).css("background-color","");enable_drag($("#"+this.model.get("id")));this.$el.trigger("reveal:close")},verwijder:function(){$("#"+this.model.get("id")).remove();this.model.destroy();this.$el.trigger("reveal:close")}}),BestellingListView=Backbone.View.extend({initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addOne:function(e){console.log(e);var t=new BestellingView({model:e});e.get("status")==1&&e.get("afgerond")==null&&$("#col1 ul").prepend(t.render().el);e.get("status")==4&&$("#taxi_"+e.get("taxi")+" ul").find(".status4").before(t.render().el);(e.get("status")==2||e.get("status")==3)&&$("#taxi_"+e.get("taxi")+" ul").find(".status4").after(t.render().el);e.get("status")==5&&$("#taxi_"+e.get("taxi")+" ul").find(".afgerond").after(t.render().el)},addAll:function(){this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}}),TaxiListView=Backbone.View.extend({initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addOne:function(e){var t=new TaxiView({model:e});$(".colmap").before(t.render().el)},addAll:function(){this.collection.forEach(this.addOne,this);AdminPanel.bestellingList.fetch()},render:function(){this.addAll()}}),TaxiView=Backbone.View.extend({className:"col",events:{drop:"dropped","click .set":"settings"},template:Handlebars.compile(taxi_template),render:function(){this.el.id="taxi_"+this.model.get("id");this.$el.html(this.template(this.model.toJSON()));this.$el.droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover"});this.marker(this.model);this.model.get("Pauze")==0?this.$el.find("h1").css("border-right","solid 4px rgb(144, 189, 60)"):this.$el.find("h1").css("border-right","solid 4px rgb(253, 64, 0)");channeltaxi=pusher.subscribe("taxi_"+this.model.get("id"));channeltaxi.bind("taxi_pauze_"+this.model.get("id"),function(e){e.Pauze==0?$("#taxi_"+e.id).find("h1").css("border-right","solid 4px rgb(144, 189, 60)"):$("#taxi_"+e.id).find("h1").css("border-right","solid 4px rgb(253, 64, 0)")});$("#taxiselect").append('<option value="'+this.model.get("id")+'">'+this.model.get("Naam")+"</option>");return this},dropped:function(e,t){var n=t.draggable.find("li").attr("id"),r=AdminPanel.bestellingList.get(n);if(r.get("taxi")!=this.model.get("id")){this.$el.find(".ritten").find(".afgerond").before(t.draggable);var n=t.draggable.find("li").attr("id"),i=t.draggable,s=r.get("taxi");r.set({taxioud:s,taxi:this.model.get("id")});var o=new BestellingRevealView({model:r});r.get("status")==1?$("#checkmodal").reveal({closed:function(){r.get("status")==1&&$("#col1 ul").append(i)}}):r.save();$("#checkmodal .inforit").html(o.render(1).el)}},marker:function(e){var t=new google.maps.LatLng(e.get("id"),4.483333),n=new google.maps.Marker({position:t,map:map});channel_bedrijf.bind("client-taxi_"+e.get("id"),function(e){n.setPosition(new google.maps.LatLng(e.lat,e.lang))});n.setIcon(base_url+"images/markers/number_"+e.get("id")+".png")},settings:function(){console.log(this.model);var e=new TaxisettingsView({model:this.model});$("#taxi_settings_modal").reveal();$("#taxi_settings_modal").html(e.render().el)}}),TaxisettingsView=Backbone.View.extend({template:Handlebars.compile(taxi_settings),events:{"click #loguit":"update","click #delete":"delete"},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},update:function(){this.model.set({Naam:this.$el.find("input[name=naam]").val(),pass:this.$el.find("input[name=pass]").val()});this.model.save();this.$el.trigger("reveal:close");$("#taxi_"+this.model.get("id")).find("h1").html(this.model.get("Naam"))},"delete":function(){$("#taxi_"+this.model.get("id")).remove();this.model.destroy();this.$el.trigger("reveal:close")}}),AdminPanel=new(Backbone.Router.extend({routes:{"":"index"},initialize:function(){this.bestellingList=new BestellingList;this.bestellingListView=new BestellingListView({collection:this.bestellingList});this.taxiList=new TaxiList;this.taxiListView=new TaxiListView({collection:this.taxiList});this.user=new User},start:function(){Backbone.history.start({pushState:!0});this.user.fetch()},index:function(){this.user.fetch()}}));Pusher.log=function(e){window.console&&window.console.log&&window.console.log(e)};WEB_SOCKET_DEBUG=!0;var pusher=new Pusher("b075ffa0df361cc21bda");Pusher.channel_auth_endpoint=base_url+"pusher/auth.php";var channel=pusher.subscribe("admin_all");channel.bind("taxi_bestelt",function(e){var t=new Bestelling(e);AdminPanel.bestellingList.add(t)});console.log("admin_"+$("#hiddenid").val());channel.bind("admin_"+$("#hiddenid").val(),function(e){var t=AdminPanel.bestellingList.get(e.id);t.set({status:e.Status});console.log(t);e.Status==3&&$("#"+e.id).css("background-color","#90BD3C");if(e.Status==4){$("#"+e.id).css("background-color","#F2A81D");$("#taxi_"+t.get("taxi")+" ul").find(".status4").before($("#"+e.id));$("#"+e.id).find("button").click(function(){t.showmodal()})}if(e.Status==5){$("#"+e.id).css("opacity","0.5");$("#"+e.id).css("background","none");$("#taxi_"+t.get("taxi")+" ul").find(".afgerond").after($("#"+e.id));$("#"+e.id).find("button").click(function(){t.showmodal()})}});channel.bind("delete",function(e){if(e.iduser!=$("#hiddenid").val()){$("#"+e.idbestelling).remove();var t=AdminPanel.bestellingList.get(e.idbestelling);AdminPanel.bestellingList.remove(t)}});$(document).ready(function(){AdminPanel.start();$("#extra_kolom_btn").click(function(){AdminPanel.taxiList.create({Login:current_user_login+"_"+$("#nieuw_kolom").val(),fkUser:current_user_id,Naam:$("#nieuw_kolom").val()});$("#nieuw_kolom").val("")});taximap();$("#taximap_click").toggle(function(){$(".sidebar").animate({right:"0px"},500);$("#taximap_click img").css("background-color","rgba(225,225,225,0.75)")},function(){$(".sidebar").animate({right:"-500px"},500);$("#taximap_click img").css("background-color","inherit")});$("#voegtoe").click(function(){var e={naam:$("#settings_modal").find("input[name=Naam]").val(),tel:$("#settings_modal").find("input[name=Tel]").val(),adres1:$("#settings_modal").find("input[name=Adres1]").val(),adres2:$("#settings_modal").find("input[name=Adres2]").val(),tijd:$("#settings_modal").find("input[name=Tijd]").val(),taxi:$("#settings_modal").find("select").val(),fkUser:current_user_id,status:3,afgerond:1};$.ajax({type:"POST",url:"admin/bestellingtoevoegen",data:e,dataType:"json",success:function(t){pauze=t.pauze;e={naam:$("#settings_modal").find("input[name=Naam]").val(),tel:$("#settings_modal").find("input[name=Tel]").val(),adres1:$("#settings_modal").find("input[name=Adres1]").val(),adres2:$("#settings_modal").find("input[name=Adres2]").val(),tijd:$("#settings_modal").find("input[name=Tijd]").val(),taxi:$("#settings_modal").find("select").val(),fkUser:current_user_id,status:3,afgerond:1,id:t.fkBestelling};var n=new Bestelling(e);AdminPanel.bestellingList.add(n);$("#settings_modal").trigger("reveal:close")}})})});$("#settings").click(function(){console.log("test");$("#timedate").datetimepicker({controlType:"select"});var e=moment().format("DD/MM/YYYY HH:mm ");$("#timedate").val(e);$("#settings_modal").reveal()});