//Backbone.emulateHTTP = true
//Models
var Bestelling=Backbone.Model.extend({setstatus:function(e){this.set({status:e,wachttijd:$(".wachttijd").val()});this.save()}}),BestellingList=Backbone.Collection.extend({model:Bestelling,url:"http://localhost:8888/TaxiNu/api/bestelling/"}),BestellingView=Backbone.View.extend({template:Handlebars.compile(bestelling_tempalte),events:{"click button":"showmodule"},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},showmodule:function(){var e=new BestellingRevealView({model:this.model});$("#checkmodal").reveal();$("#checkmodal .inforit").html(e.render(this.model.get("status")).el)}}),BestellingRevealView=Backbone.View.extend({template1:Handlebars.compile(module_bestelling_template1),template2:Handlebars.compile(module_bestelling_template2),events:{"click button":"go"},render:function(e){(e==1||e==3)&&this.$el.html(this.template1(this.model.toJSON()));e==2&&this.$el.html(this.template2(this.model.toJSON()));return this},go:function(){this.model.setstatus(2);$("#"+this.model.get("id")).remove();$("#checkmodal").trigger("reveal:close");var e=new BestellingView({model:this.model});$("#col"+this.model.get("status")+" ul").append(e.render(this.model.get("status")).el)}}),BestellingListView=Backbone.View.extend({initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addOne:function(e){console.log(e.get("status"));if(e.get("afgerond")==null||e.get("status")==3){var t=new BestellingView({model:e});$("#col"+e.get("status")+" ul").append(t.render().el)}},addAll:function(){this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}}),AdminPanel=new(Backbone.Router.extend({routes:{"":"index"},initialize:function(){this.bestellingList=new BestellingList;this.bestellingListView=new BestellingListView({collection:this.bestellingList})},start:function(){Backbone.history.start({pushState:!0});this.bestellingList.fetch()},index:function(){this.bestellingList.fetch()}}));Pusher.log=function(e){window.console&&window.console.log&&window.console.log(e)};WEB_SOCKET_DEBUG=!0;var pusher=new Pusher("b075ffa0df361cc21bda"),channel=pusher.subscribe("admin_all");channel.bind("taxi_bestelt",function(e){var t=new Bestelling(e);AdminPanel.bestellingList.add(t)});channel.bind("admin_"+$("#hiddenid").val(),function(e){$("#"+e).remove();var t=AdminPanel.bestellingList.get(e),n=new BestellingView({model:t});$("#col3 ul").append(n.render(3).el)});channel.bind("delete",function(e){e.iduser!=$("#hiddenid").val()&&$("#"+e.idbestelling).remove()});$(document).ready(function(){console.log("document ready!");AdminPanel.start()});$("ul").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(e,t){$("#"+liid).appendTo(this)}}).sortable({items:"li"});$("#extra_kolom_btn p").click(function(){var e=$("#nieuw_kolom").val(),t=$('<div class="col" class="new"><h1>'+e+'</h1><ul class="ritten"></ul></div>');console.log(e);$(".wrapper").append(t)});$("#settings").click(function(){$("#settings_modal").reveal()});